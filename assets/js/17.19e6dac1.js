(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{337:function(t,s){t.exports="data:image/png;base64,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"},391:function(t,s,a){"use strict";a.r(s);var n=a(5),p=function(t){t.options.__data__block__={flowchart_382ee188:"\nst=>start: 鼠标点击\ne=>end: 结束\nrender=>operation: 使用hit着色器渲染场景\nframe=>inputoutput: 输出到帧缓存\ncal_xy=>operation: 换算出帧缓存中对应的坐标\nget_color=>inputoutput: 从帧缓存中取出颜色\ncond=>condition: 颜色=猫的颜色？\nhit_cat=>operation: 点中猫\nmiss=>operation: 没点中\n\nst->render->frame->cal_xy->get_color->cond\ncond(yes)->hit_cat->e\ncond(no)->miss->e",flowchart_382ee18c:"\nst=>start: 鼠标点击\ne=>end: 结束\ncal_xy=>inputoutput: 计算出鼠标移动dx,dy、当前坐标x,y\nis_hit=>subroutine: 检查当前是否命中猫模型\ncond=>condition: 选中猫？\nmove_cat=>operation: (dx,dy,0)与逆矩阵invMat做乘法，算出正确的平移参数\nchange_world=>inputoutput: 对猫模型世界矩阵做修改，发送到着色器\ntrack_ball=>operation: 根据虚拟跟踪球，求出dz\ncal_axis=>operation: 用(dx,dy,dz)求出旋转轴和角度\nchange_camera=>inputoutput: 对相机位置进行修改，发送到着色器\n\nst->cal_xy->is_hit->cond\ncond(yes)->move_cat->change_world->e\ncond(no)->track_ball->cal_axis->change_camera->e"}},r=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"模型的点选和平移"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#模型的点选和平移"}},[t._v("#")]),t._v(" 模型的点选和平移")]),t._v(" "),n("h2",{attrs:{id:"基本原理"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#基本原理"}},[t._v("#")]),t._v(" 基本原理")]),t._v(" "),n("h3",{attrs:{id:"点选"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#点选"}},[t._v("#")]),t._v(" 点选")]),t._v(" "),n("blockquote",[n("p",[t._v("模型的点击选中也是我们常常能看到的功能，在3D绘图软件和游戏中都有很广泛的应用。一般来说，实现它的方式有两种，一种是射线选择法，另一种则是我们使用的在帧缓存中存储特有颜色或id的方法。")])]),t._v(" "),n("p",[t._v("射线选择法的基本原理就是，当点选某个像素时，我们看作从观察点向该方向发出一条射线。这条射线与哪个模型相交，就等于选中了哪个模型。射线选择法被许多著名的3D库使用，包括Three.js。射线选择法的好处是比较通用，但实现起来需要判断射线和片元的交点，比较繁琐。")]),t._v(" "),n("p",[t._v("我们使用的方法是在用户点击画布时，离屏渲染一张图片，顶点着色器和实际显示所用的一致，片元着色器仅仅为片元涂上给定的颜色。通过"),n("code",[t._v("gl.readPixels")]),t._v("方法，就可以读出当前鼠标点击的位置的颜色，进而判断点中了什么模型。此时帧缓存中的图像如下图所示。")]),t._v(" "),n("p",[n("img",{attrs:{src:a(337),alt:"帧缓存中的图像"}})]),t._v(" "),n("h3",{attrs:{id:"平移"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#平移"}},[t._v("#")]),t._v(" 平移")]),t._v(" "),n("p",[t._v("选中模型后就需要平移。最简单的做法是，将鼠标在x,y轴上的移动直接映射到模型的x,y轴平移上。但是我们的视点会移动，当其朝向不再朝向正z轴方向时，这一移动就会与用户的心理预期不符。如何修正这种偏移呢？我们使用投影-视图-世界-模型矩阵的乘积的逆矩阵，与鼠标移动的向量相乘，得到的值作为模型的平移参数。这样做的好处是，不论视点如何变化，用户的鼠标平移都会在屏幕上表现得方向一致。")]),t._v(" "),n("h2",{attrs:{id:"设计思路"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#设计思路"}},[t._v("#")]),t._v(" 设计思路")]),t._v(" "),n("p",[t._v("本事件的流程图如下：")]),t._v(" "),n("FlowChart",{attrs:{id:"flowchart_382ee188",code:t.$dataBlock.flowchart_382ee188,preset:"vue"}}),n("p",[t._v("加上跟踪球后的流程如图：")]),t._v(" "),n("FlowChart",{attrs:{id:"flowchart_382ee18c",code:t.$dataBlock.flowchart_382ee18c,preset:"vue"}}),n("p",[t._v("属于基本的流程控制和事件侦听，此处不过多叙述。")]),t._v(" "),n("h2",{attrs:{id:"具体实现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#具体实现"}},[t._v("#")]),t._v(" 具体实现")]),t._v(" "),n("p",[t._v("顶点着色器和主着色器共用代码，因此略过。片段着色器的代码如下：")]),t._v(" "),n("div",{staticClass:"language-GLSL extra-class"},[n("pre",{pre:!0,attrs:{class:"language-glsl"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("precision")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("mediump")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("float")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("uniform")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("vec4")]),t._v(" v_Color"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("main")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tgl_FragColor"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("v_Color"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),n("p",[t._v("其实十分类似产生阴影深度的着色器代码，只是改为附上颜色罢了。")]),t._v(" "),n("p",[t._v("接下来是JavaScript中事件侦听的代码：")]),t._v(" "),n("div",{staticClass:"language-JavaScript extra-class"},[n("pre",{pre:!0,attrs:{class:"language-javascript"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//鼠标点击事件")]),t._v("\ncanvas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmousedown")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("e")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" bbox "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" canvas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBoundingClientRect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" x "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("clientX "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" bbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("left"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" y "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" canvas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("height"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("clientY "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" bbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("top"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("bindFramebufferInfo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("fbi2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" readout"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Uint8Array")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//绘制hit帧")]),t._v("\n      twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("bindFramebufferInfo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("fbi2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      gl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("clear")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("COLOR_BUFFER_BIT")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("|")]),t._v(" gl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("DEPTH_BUFFER_BIT")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("  \n      gl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("useProgram")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("hit_programInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("program "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setUniforms")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("hit_programInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("light_uniform"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setBuffersAndAttributes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" hit_programInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" catBufferInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setUniforms")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("hit_programInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" cat_uniforms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setUniforms")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("hit_programInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" projection_uniforms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setUniforms")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("hit_programInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" view_uniforms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("drawBufferInfo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" catBufferInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n      twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setBuffersAndAttributes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("hit_programInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("boardBufferInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      board_uniform"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uWorld"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("m4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTranslation")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("m4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("identity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("50")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setUniforms")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("hit_programInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" board_uniform"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setUniforms")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("hit_programInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" projection_uniforms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setUniforms")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("hit_programInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" view_uniforms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("drawBufferInfo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("boardBufferInfo"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      gl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("readPixels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("gl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("RGBA")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("gl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[t._v("UNSIGNED_BYTE")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("readout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("readout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("is_cat")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("readout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            mouseFlag"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            catMove"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            lastMousePosX"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            lastMousePosY"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            cat_uniforms"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("u_texture"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("tex3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            mouseFlag"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            trackBall"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token boolean"}},[t._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            lastMousePosX"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n            lastMousePosY"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n      twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("bindFramebufferInfo")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("gl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//鼠标滚轮事件")]),t._v("\ncanvas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("onmousewheel")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("preventDefault")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" dy"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("deltaY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n      camera_uniform"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("u_viewWorldPosition"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("m4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("transformPoint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("m4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("translate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("m4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("identity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("dy"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("camera_uniform"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("u_viewWorldPosition"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//鼠标移动事件")]),t._v("\ncanvas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("addEventListener")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"mousemove"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("event")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("!")]),t._v("mouseFlag"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" bbox "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" canvas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getBoundingClientRect")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" x "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("clientX "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" bbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("left"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" y "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" canvas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("height"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("clientY "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v(" bbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("top"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("canvas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("height"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("height"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" dx"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("x"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("lastMousePosX"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" dy"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("y"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("lastMousePosY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" ratio_x"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("x"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("lastMousePosX"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("canvas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("width"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" ratio_y"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("y"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),t._v("lastMousePosY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("canvas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("height"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("catMove"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" offset"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("m4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("transformPoint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("invMat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.01")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        offset"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("v3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("subtract")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("m4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("transformPoint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("invMat"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("dx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("dy"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0.01")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("offset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("if")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("light_uniform"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("uShadow_type"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("v3"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("divide")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("offset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("300")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("offset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("changeCatLocation")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("offset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("ratioX"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ratioY"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("offset"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("else")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" r_x "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("x "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("canvas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("width"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("width"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("canvas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("width"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" r_y "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("y"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("canvas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("height"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" last_rx"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("lastMousePosX"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("canvas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("width"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("bbox"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("width"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("canvas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("width"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" last_ry"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("lastMousePosY"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("/")]),t._v("canvas"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("height"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" ans "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("mouseMotion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("r_x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("last_ry"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("last_rx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("r_y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        camera_uniform"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("u_viewWorldPosition"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("m4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("transformPoint")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("m4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("axisRotate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("twgl"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("m4"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("identity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("ans"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("axis"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("*")]),t._v("ans"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("angle"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("camera_uniform"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("u_viewWorldPosition"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n    lastMousePosX"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("x"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    lastMousePosY"),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v("y"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])])],1)}),[],!1,null,null,null);"function"==typeof p&&p(r);s.default=r.exports}}]);